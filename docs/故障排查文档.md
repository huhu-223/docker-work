# 故障排查文档

## 常见问题及解决方案

### 1. Docker服务问题

#### 问题：Docker服务未启动
```bash
# 检查Docker状态
systemctl status docker

# 启动Docker
systemctl start docker
```

#### 问题：权限不足
```bash
# 将用户添加到docker组
sudo usermod -aG docker $USER
# 重新登录生效
```

### 2. 镜像构建问题

#### 问题：Maven依赖下载失败
```bash
# 检查网络
ping maven.aliyun.com

# 使用国内镜像源
# 在pom.xml中添加阿里云镜像
```

#### 问题：npm安装失败
```bash
# 使用淘宝镜像
npm config set registry https://registry.npmmirror.com
```

### 3. 容器启动问题

#### 问题：端口被占用
```bash
# 查看端口占用
netstat -tlnp | grep :80
lsof -i :80

# 停止占用进程或修改端口映射
```

#### 问题：容器启动后立即退出
```bash
# 查看容器日志
docker logs <container_id>

# 查看退出原因
docker inspect <container_id> | grep -A 5 "State"
```

### 4. 数据库连接问题

#### 问题：后端无法连接MySQL
```bash
# 检查MySQL是否就绪
docker-compose exec mysql mysqladmin ping -h localhost -uroot -proot

# 检查网络连通性
docker-compose exec backend ping mysql

# 检查连接字符串
# 确保使用服务名 mysql 而不是 localhost
```

#### 问题：数据库初始化失败
```bash
# 查看MySQL日志
docker-compose logs mysql

# 重新初始化（删除数据卷）
docker-compose down -v
docker-compose up -d
```

### 5. 网络问题

#### 问题：容器间无法通信
```bash
# 检查网络
docker network ls
docker network inspect docker-work_ecommerce-network

# 确保所有服务在同一网络
docker-compose ps
```

#### 问题：前端无法访问后端API
```bash
# 在前端容器中测试
docker-compose exec frontend curl http://backend:8080/api/category/list

# 检查Nginx配置
docker-compose exec frontend cat /etc/nginx/nginx.conf
```

### 6. 健康检查失败

#### 问题：服务健康检查一直失败
```bash
# 查看健康检查状态
docker inspect --format='{{json .State.Health}}' <container_id>

# 手动执行健康检查命令
docker-compose exec backend wget --no-verbose --tries=1 --spider http://localhost:8080/api/category/list
```

### 7. 性能问题

#### 问题：服务响应慢
```bash
# 查看容器资源使用
docker stats

# 增加资源限制
# 修改docker-compose.yml中的resources配置
```

#### 问题：磁盘空间不足
```bash
# 清理未使用的资源
docker system prune -a

# 清理构建缓存
docker builder prune
```

## 日志查看

```bash
# 查看所有服务日志
docker-compose logs

# 实时查看日志
docker-compose logs -f

# 查看特定服务日志
docker-compose logs -f backend
docker-compose logs -f mysql
docker-compose logs -f frontend

# 查看最近100行日志
docker-compose logs --tail=100 backend
```

## 重启服务

```bash
# 重启所有服务
docker-compose restart

# 重启特定服务
docker-compose restart backend

# 重新构建并启动
docker-compose up -d --build
```

## 数据备份与恢复

### 备份MySQL数据
```bash
docker-compose exec mysql mysqldump -uroot -proot work_eight > backup.sql
```

### 恢复MySQL数据
```bash
docker-compose exec -T mysql mysql -uroot -proot work_eight < backup.sql
```

## 联系支持

如果以上方法无法解决问题，请提供以下信息：
1. `docker-compose logs` 输出
2. `docker-compose ps` 输出
3. `docker version` 输出
4. 操作系统版本
